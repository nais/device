// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: gateway_jita_grants.sql

package sqlc

import (
	"context"
	"database/sql"
)

const getGatewayJitaGrantsForUser = `-- name: GetGatewayJitaGrantsForUser :many
SELECT id, user_id, gateway_name, created, expires, revoked, reason FROM gateway_jita_grants
WHERE user_id = ?1
ORDER BY id DESC
LIMIT 10
`

func (q *Queries) GetGatewayJitaGrantsForUser(ctx context.Context, userID string) ([]*GatewayJitaGrant, error) {
	rows, err := q.query(ctx, q.getGatewayJitaGrantsForUserStmt, getGatewayJitaGrantsForUser, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*GatewayJitaGrant
	for rows.Next() {
		var i GatewayJitaGrant
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.GatewayName,
			&i.Created,
			&i.Expires,
			&i.Revoked,
			&i.Reason,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const grantPrivilegedGatewayAccess = `-- name: GrantPrivilegedGatewayAccess :exec
INSERT INTO gateway_jita_grants (
    user_id,
    gateway_name,
    created,
    expires,
    reason
)
VALUES (
    ?1,
    ?2,
    ?3,
    ?4,
    ?5
)
`

type GrantPrivilegedGatewayAccessParams struct {
	UserID      string
	GatewayName string
	Created     string
	Expires     string
	Reason      string
}

func (q *Queries) GrantPrivilegedGatewayAccess(ctx context.Context, arg GrantPrivilegedGatewayAccessParams) error {
	_, err := q.exec(ctx, q.grantPrivilegedGatewayAccessStmt, grantPrivilegedGatewayAccess,
		arg.UserID,
		arg.GatewayName,
		arg.Created,
		arg.Expires,
		arg.Reason,
	)
	return err
}

const revokePrivilegedGatewayAccess = `-- name: RevokePrivilegedGatewayAccess :exec
UPDATE gateway_jita_grants
SET revoked = ?1
WHERE
    user_id = ?2
    AND gateway_name = ?3
    AND revoked IS NULL
`

type RevokePrivilegedGatewayAccessParams struct {
	Revoked     sql.NullString
	UserID      string
	GatewayName string
}

func (q *Queries) RevokePrivilegedGatewayAccess(ctx context.Context, arg RevokePrivilegedGatewayAccessParams) error {
	_, err := q.exec(ctx, q.revokePrivilegedGatewayAccessStmt, revokePrivilegedGatewayAccess, arg.Revoked, arg.UserID, arg.GatewayName)
	return err
}

const userHasAccessToPrivilegedGateway = `-- name: UserHasAccessToPrivilegedGateway :one
SELECT EXISTS(
    SELECT id FROM gateway_jita_grants
    WHERE
        user_id = ?1
        AND gateway_name = ?2
        AND DATETIME(expires) > DATETIME('now')
        AND revoked IS NULL
) AS has_access
`

type UserHasAccessToPrivilegedGatewayParams struct {
	UserID      string
	GatewayName string
}

func (q *Queries) UserHasAccessToPrivilegedGateway(ctx context.Context, arg UserHasAccessToPrivilegedGatewayParams) (int64, error) {
	row := q.queryRow(ctx, q.userHasAccessToPrivilegedGatewayStmt, userHasAccessToPrivilegedGateway, arg.UserID, arg.GatewayName)
	var has_access int64
	err := row.Scan(&has_access)
	return has_access, err
}
