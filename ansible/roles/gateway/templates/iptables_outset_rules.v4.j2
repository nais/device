# Generated by iptables-save v1.8.4 on Mon May  4 07:54:01 2020
*filter
:INPUT ACCEPT [33991:382633466]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [27241:3181841]
:sshguard - [0:0]
-A INPUT -j sshguard
{% if onprem %}
-A FORWARD -i wg0 -o ens160 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i ens160 -o wg0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
{% else %}
-A FORWARD -i wg0 -o ens4 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i ens4 -o wg0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i wg0 -o ens4 -p tcp -m tcp -d {{ K8S_CLUSTER_API_IP_ADDRESS }}/32 --dport 443 --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j LOG --log-level 6 --log-prefix "naisdevice-fwd: "
-A FORWARD -i wg0 -o ens4 -p tcp -m tcp -d {{ K8S_CLUSTER_API_IP_ADDRESS }}/32 --dport 443 --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j ACCEPT
{% endif %}
COMMIT
# Completed on Mon May  4 07:54:01 2020
# Generated by iptables-save v1.8.4 on Mon May  4 07:54:01 2020
*nat
:PREROUTING ACCEPT [11:1804]
:INPUT ACCEPT [8:448]
:OUTPUT ACCEPT [229:17447]
:POSTROUTING ACCEPT [229:17447]
{% if not onprem and tunnel_ip is defined %}
-A PREROUTING -i wg0 -d {{ tunnel_ip }} -p tcp -m tcp --dport 443 -j DNAT --to-destination {{ K8S_CLUSTER_API_IP_ADDRESS }}
-A POSTROUTING -d {{ K8S_CLUSTER_API_IP_ADDRESS }}/32 -o ens4 -p tcp -m tcp --dport 443 -j SNAT --to-source {{ ansible_default_ipv4.address }}
{% endif %}
COMMIT
# Completed on Mon May  4 07:54:01 2020
